---
title: "Rocky Linux部署静态网站·番外"
created: 2024-01-27
modified: 2025-05-13
locale: zh
keywords: >
    VPS, Rocky Linux, COS, CDN, CORS
---

这篇番外，大部分可看作是云服务商的相关功能的试用记录，也在我电脑上存放了较长时间。趁着VPS未到期，我在2024年重新过了一遍流程和配置，而实际上的使用应该在2019年前后左右。

这里关于CDN、HTTPS、CORS的细节，可能已过时。一边，各服务商的操作面板和菜单都不相同，平台也面临更新改版，我无意在这方面追求准确。另一边，我现在在配置良好运行之后，习惯性地即时记录，以备用。所以该篇仅留作参考。

## CDN服务

在个人网站上，如果你已经预处理过图片、音视频、Web字体、部分CSS和JS脚本等媒体文件，并且使用CDN节点来访问它们，即使是套餐里最辣鸡的低配VPS，也可以获得很好的速度。而较流行的做法，通常是将大型的媒体文件如音频、视频等上传到各大流媒体平台。

这里拿腾讯云CDN举例。

### 新建COS储存桶，绑定CDN

1. 云产品 → 对象存储 → 存储桶列表 → 创建存储桶... → 公有读私有写
2. 内容分发网络 → 域名管理 → 添加域名... → 静态加速/流媒体点播加速 → COS源
    1. 高级配置 → 宽带封顶配置 → 访问闸值
3. DNS解析 → 添加记录 → 记录类型CNAME...

### 新建子账号控制COS、CDN

1. 控制台 → 访问管理 → 用户/用户列表 → 新建用户 → 快速创建... → 成功新建用户 → 下载CSV文件
2. 打开访客窗口或无痕窗口 → 登录界面/子账号 → 腾讯云 → 右上角 → 填写账号ID, 初始密码 → 重置密码 → 完善关联手机信息
3. 主账号 → 控制台 → 访问管理 → 用户/用户设置 → 目标子账号 → 授权 → 搜索`COS`并全选条目 → 搜索`CDN`并全选条目 → 确定
4. 子账号 → 控制台 → 访问管理 → API密钥管理 → 新建密钥 → 创建SecretKey → 下载CSV文件 → 我已知晓并保存SecretKey (On) → 确定

### 配置CDN

1. 主账号 → 控制台 → 内容分发网路 → 添加域名 → 域名配置 → 验证方法... → 验证：
    ```
    加速区域 全球
    加速类型 CDN网页小文件 # 文件类型是html, css, js等网页文件、Web字体、vtt字幕等时，可选择此类型
                           # 是音频、视频文件时，可选择CDN音视频点播
    源站类型 COS源
    源站类型 目标COS桶
    ```
2. 下一步... → 提升访问性能 → 智能压缩 (Off)
3. 下一步 → 防止费用超额 → 配置封顶配置 → 生效下方配置项 (On) → 新增规则:
    ```
    统计类型 累计用量
    统计周期 每小时
    流量封顶 流量封顶 10GB
    解封时间 永不解封
    告警阈值 开启
    ```
    ```
    统计类型 瞬间用量
    封顶配置 流量封顶 1536MB(1.5GB)
    解封时间 永不解封
    ```
4. 提交所有配置
5. 配置CNAME → 一键配置 → 确定

## CDN启用HTTPS

1. 云产品 → SSL证书 → 我的证书 → 申请
2. 内容分发网络 → 域名管理 → 管理 → HTTPS配置 → 配置证书

Rocky Linux里，如果你在重启`httpd`或者设置SSL时出错，通常跟`/etc/httpd/conf/httpd.conf`和`/etc/httpd/sites-available/`里的配置有关。可尝试运行`systemctl status httpd.service`后，按提示删除报错的文件。

## 设置跨域访问CORS

可用于CDN字体服务等。详情参考[设置静态网站](https://cloud.tencent.com/document/product/436/14984)、[设置跨域访问](https://cloud.tencent.com/document/product/436/13318)。大致流程为：

1. 新建储存桶，用于静态网站
    1. 储存桶 → 安全管理 → 跨域访问CORS设置 → 添加规则
    2. 上传网页字体文体到储存桶
2. 给储存桶设置CDN加速
    1. 设置HTTP响应头配置
3. 在`.css`文件中调用字体文件的网址，进行测试
